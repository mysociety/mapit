Thanks to Matthew Somerville for advice on on fixing this
